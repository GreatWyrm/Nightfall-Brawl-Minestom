package me.arcanewarrior.com.damage.invulnticks;

import net.minestom.server.MinecraftServer;
import net.minestom.server.entity.Entity;

import java.util.HashMap;
import java.util.UUID;

public class InvulnerabilityTicksImpl implements InvulnerabilityTicks {

    // Map of UUID to the time when an entity can be damaged again
    // NOTE: This will fill up over time as long as the server is up, will need a different implementation in the future
    private final HashMap<UUID, Long> invulnerabilityTime = new HashMap<>();

    @Override
    public boolean isEntityInvulnerable(Entity entity) {
        UUID id = entity.getUuid();
        if(!invulnerabilityTime.containsKey(id)) return false;

        // Return true if the time of the entity is greater than the current time
        return invulnerabilityTime.get(id) > System.currentTimeMillis();
    }

    @Override
    public void setInvulnerabilityTicks(Entity entity, int ticks) {
        if(ticks <= 0) {
            invulnerabilityTime.put(entity.getUuid(), System.currentTimeMillis());
        }
        invulnerabilityTime.put(entity.getUuid(), System.currentTimeMillis() + (long) MinecraftServer.TICK_MS * ticks);
    }
}
